<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SokuSelect - 測量士 記述式攻略</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="v2.css">
    <!-- Google Fonts for premium feel -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@400;500;700&display=swap"
        rel="stylesheet">
    <script src="https://apis.google.com/js/api.js" async defer></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>
    <!-- Start Screen Overlay -->
    <div id="start-screen" class="overlay active"
        style="background: linear-gradient(135deg, #4a8a6a 0%, #5aaa7a 100%);">
        <div class="start-screen-content" style="padding:1rem; max-width:400px;">
            <h1 class="start-title" style="font-size:1.4rem; margin-bottom:0.2rem;">SokuSelect<br><span
                    style="font-size:0.5em; font-weight:500; opacity:0.9;">測量士 文章訂正ドリル</span></h1>
            <div style="text-align:center; font-size:0.6rem; color:#94a3b8; margin-bottom:2px;">Build: 2024-12-29 08:24
            </div>
            <div id="login-status" style="text-align:center; font-size:0.65rem; margin-bottom:2px;"><span
                    style="color:#fbbf24;">⚪ 未ログイン</span></div>
            <div id="sync-status"
                style="text-align:center; font-size:0.65rem; color:#94a3b8; margin-bottom:2px; min-height:1em;"></div>
            <div id="file-timestamps"
                style="text-align:center; font-size:0.6rem; color:#94a3b8; margin-bottom:6px; line-height:1.3; display:none;">
                <span>📚 <span id="q-file-time">--</span></span> ｜ <span>📊 <span id="s-file-time">--</span></span>
            </div>

            <div style="display:flex; justify-content:center; gap:8px; margin-bottom:12px;">
                <button id="auth-btn-start" class="icon-btn" title="Google認証"
                    style="width:36px; height:36px; font-size:1rem; background:#fef3c7; border:2px solid #f59e0b;">G</button>
                <button id="sync-load-btn" class="icon-btn" title="データ読込"
                    style="width:36px; height:36px; font-size:1rem; background:#dbeafe; border:2px solid #3b82f6;">📥</button>
                <button id="sync-save-btn" class="icon-btn" title="データ保存"
                    style="width:36px; height:36px; font-size:1rem; background:#dcfce7; border:2px solid #22c55e;">📤</button>
                <button id="params-btn-start" class="icon-btn" title="統計"
                    style="width:36px; height:36px; font-size:1rem;">📊</button>
                <button id="editor-btn-start" class="icon-btn" title="問題編集"
                    style="width:36px; height:36px; font-size:1rem;">📝</button>
            </div>

            <div class="setting-section" style="margin-bottom:10px;">
                <label class="setting-label" style="font-size:0.9rem; margin-bottom:4px;">ジャンル</label>
                <div class="genre-grid" id="genre-options" style="gap:6px;">
                    <div class="genre-card selected" data-value="all" style="padding:6px; font-size:0.85rem;">すべて</div>
                    <div class="genre-card" data-value="法規等" style="padding:6px; font-size:0.85rem;">法規等</div>
                    <div class="genre-card" data-value="基準点測量" style="padding:6px; font-size:0.85rem;">基準点測量</div>
                    <div class="genre-card" data-value="地図・GIS" style="padding:6px; font-size:0.85rem;">地図・GIS</div>
                    <div class="genre-card" data-value="応用測量" style="padding:6px; font-size:0.85rem;">応用測量</div>
                </div>
            </div>

            <div class="setting-section" style="margin-bottom:12px;">
                <label class="setting-label" style="font-size:0.9rem; margin-bottom:4px;">問題数</label>
                <div class="count-options" id="count-options" style="gap:6px;">
                    <div class="count-btn" data-value="5" style="padding:6px; font-size:0.85rem;">5問</div>
                    <div class="count-btn selected" data-value="10" style="padding:6px; font-size:0.85rem;">10問</div>
                    <div class="count-btn" data-value="20" style="padding:6px; font-size:0.85rem;">20問</div>
                </div>
            </div>

            <button id="start-btn" class="btn btn-primary"
                style="width:100%; padding:0.8rem; font-size:1.1rem;">試験を開始する</button>
        </div>
    </div>

    <!-- Modal Overlay (for dropdowns) -->
    <div class="overlay" id="overlay"></div>

    <div class="container">
        <header>
            <div class="brand">
                <span class="brand-sub">測量士 国家試験対策</span>
                <h1>SokuSelect <span class="version">v3.0</span></h1>
            </div>
            <div id="game-area-placeholder" style="display:none;"></div>
        </header>

        <main id="game-area">
            <div class="progress-container">
                <div class="progress-bar" id="progress">Q1 / 10</div>
                <span id="question-id-display" class="question-id-badge">ID: ---</span>
            </div>
            <div class="question-container">
                <div class="instruction" id="instruction-text">誤っている箇所を訂正しなさい</div>
                <div id="sentence-area" class="sentence-display">
                    <!-- Dynamic Sentence with Interactive Spans -->
                </div>
            </div>

            <!-- Positioned dynamically -->
            <div id="selection-modal" class="selection-modal hidden">
                <!-- Options injected here -->
            </div>

            <div id="feedback" class="feedback-box">
                <div class="feedback-layout">
                    <div class="char-avatar-container">
                        <!-- Simple Character Avatar (CSS or SVG) -->
                        <div
                            style="width:100%; height:100%; background:#dbeafe; display:flex; align-items:center; justify-content:center; font-size:2rem;">
                            👩‍💼</div>
                    </div>
                    <div class="feedback-content">
                        <div id="char-msg" class="char-bubble"></div>
                        <h3 id="feedback-title" class="feedback-title">判定結果</h3>
                        <p id="feedback-desc" class="feedback-text">解説...</p>
                    </div>
                </div>
            </div>

            <div class="controls-area">
                <button id="check-btn" class="btn btn-primary">決定</button>
                <div style="display:flex; gap:10px;">
                    <button id="next-btn" class="btn btn-next hidden">次へ進む</button>
                    <button id="game-edit-btn" class="btn btn-secondary hidden" title="この問題を編集">📝</button>
                </div>
            </div>
        </main>

        <!-- Editor Screen -->
        <div id="editor-screen" class="screen hidden">
            <header class="app-header">
                <h2>問題編集 <span id="editor-login-status" style="font-size:0.7rem; margin-left:10px;"></span></h2>
                <button id="editor-close-btn" class="icon-btn">✖</button>
            </header>
            <div class="editor-content">
                <div class="editor-controls">
                    <button id="add-question-btn" class="secondary-btn">+ 新規作成</button>
                    <button id="save-drive-btn" class="primary-btn">Driveに保存</button>
                    <button id="editor-auth-btn" class="btn btn-outline" style="margin-left:auto;">G Login</button>
                </div>
                <div id="question-list" class="question-list">
                    <!-- List of questions -->
                </div>
                <div id="editor-form" class="editor-form hidden">
                    <h3>編集</h3>
                    <div class="form-group">
                        <label>ID</label>
                        <input type="text" id="edit-id">
                    </div>
                    <div class="form-group">
                        <label>ジャンル</label>
                        <input type="text" id="edit-genre" list="genre-list">
                        <datalist id="genre-list">
                            <option value="測量法">
                            <option value="多角測量">
                            <option value="基準点測量">
                            <option value="水準測量">
                            <option value="地形測量">
                            <option value="写真測量">
                            <option value="地図編集">
                            <option value="応用測量">
                        </datalist>
                    </div>
                    <div class="form-group">
                        <label>問題文プレビュー</label>
                        <div id="segment-preview"
                            style="background:#f1f5f9; padding:10px; border-radius:6px; font-size:1.1rem; min-height:3em; color:#1e293b;">
                        </div>
                    </div>
                    <div class="form-group">
                        <!-- V9: Removed wrapper and label as requested -->
                        <div id="segment-list" class="segment-list" style="margin-bottom: 10px;"></div>
                        <!-- add-segment-btn is hidden by JS anyway in V8/V9, but keeping it for safety or removing if truly unused -->
                        <button id="add-segment-btn" class="secondary-btn" style="display:none;">+ 文節を追加</button>
                        <input type="hidden" id="edit-segments">
                    </div>
                    <div class="form-group">
                        <label>解説</label>
                        <textarea id="edit-explanation" rows="3"></textarea>
                    </div>
                    <div class="form-actions">
                        <button id="edit-save-btn" class="primary-btn">決定</button>
                        <button id="edit-cancel-btn" class="secondary-btn">キャンセル</button>
                        <button id="edit-delete-btn" class="danger-btn">削除</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Screen -->
        <div id="stats-screen" class="screen hidden">
            <header class="app-header">
                <h2>学習記録</h2>
                <button id="stats-close-btn" class="icon-btn">✖</button>
            </header>
            <div class="stats-content">
                <div class="stats-summary">
                    <div class="stat-card">
                        <h3>総回答数</h3>
                        <p id="total-answers">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>正答率</h3>
                        <p id="total-rate">0%</p>
                    </div>
                    <div class="stat-card">
                        <h3>最終学習日</h3>
                        <p id="last-played">-</p>
                    </div>
                </div>
                <h3>ジャンル別正答率</h3>
                <div id="stats-chart" class="chart-container">
                    <!-- Chart bars -->
                </div>

                <h3 style="margin-top: 20px;">問題別成績 (ワースト順)</h3>
                <div id="question-stats-list" class="question-stats-list">
                    <!-- List injected here -->
                </div>

                <button id="reset-stats-btn" class="danger-btn" style="margin-top:20px;">記録をリセット</button>
            </div>
        </div>

        <section id="result-area" class="hidden" style="text-align: center;">
            <h2 style="font-size: 2rem; color: var(--primary-color); margin-bottom: 0.5rem;" id="final-verdict">試験終了
            </h2>
            <div id="result-msg" style="margin-bottom: 2rem; font-weight: bold; color: #64748b;">お疲れ様でした！</div>

            <div class="score-value" id="final-score">0 / 0</div>

            <div class="chart-container" id="analytics-chart">
                <!-- Charts injected here -->
            </div>

            <div class="result-actions">
                <button id="retry-mistakes-btn" class="btn btn-warning hidden">間違えた問題を復習</button>
                <button onclick="location.reload()" class="btn btn-primary">設定を変えてやり直す</button>
            </div>
        </section>
    </div>

    <script src="questions.js"></script>
    <script src="app.js"></script>
</body>

</html>