<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SokuSelect - 測量士 記述式攻略</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="v2.css">
    <!-- Google Fonts for premium feel -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@400;500;700&display=swap"
        rel="stylesheet">
    <script src="https://apis.google.com/js/api.js" async defer></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>
    <!-- Start Screen Overlay -->
    <div id="start-screen" class="overlay active" style="background: rgba(15, 23, 42, 0.95);">
        <div class="start-screen-content">
            <h1 class="start-title">SokuSelect<br><span style="font-size: 0.5em; font-weight: 500; opacity: 0.8;">測量士
                    文章訂正ドリル V3</span>
            </h1>

            <div style="display:flex; justify-content:center; gap:15px; margin-bottom:20px;">
                <button id="auth-btn-start" class="icon-btn" title="Google認証"
                    style="background:white; border-radius:50%; width:40px; height:40px; font-size:1.2rem;">G</button>
                <button id="params-btn-start" class="icon-btn" title="統計"
                    style="background:white; border-radius:50%; width:40px; height:40px; font-size:1.2rem;">📊</button>
                <button id="editor-btn-start" class="icon-btn" title="問題編集"
                    style="background:white; border-radius:50%; width:40px; height:40px; font-size:1.2rem;">📝</button>
            </div>

            <div class="setting-section">
                <label class="setting-label">ジャンルを選択</label>
                <div class="genre-grid" id="genre-options">
                    <div class="genre-card selected" data-value="all">すべて</div>
                    <div class="genre-card" data-value="法規等">法規等</div>
                    <div class="genre-card" data-value="基準点測量">基準点測量</div>
                    <div class="genre-card" data-value="地図・GIS">地図・GIS</div>
                    <div class="genre-card" data-value="応用測量">応用測量</div>
                </div>
            </div>

            <div class="setting-section">
                <label class="setting-label">問題数</label>
                <div class="count-options" id="count-options">
                    <div class="count-btn" data-value="5">5問</div>
                    <div class="count-btn selected" data-value="10">10問</div>
                    <div class="count-btn" data-value="20">20問</div>
                </div>
            </div>

            <button id="start-btn" class="btn btn-primary"
                style="width: 100%; padding: 1rem; font-size: 1.2rem;">試験を開始する</button>
        </div>
    </div>

    <!-- Modal Overlay (for dropdowns) -->
    <div class="overlay" id="overlay"></div>

    <div class="container">
        <header>
            <div class="brand">
                <span class="brand-sub">測量士 国家試験対策</span>
                <h1>SokuSelect <span class="version">v3.0</span></h1>
            </div>
            <div id="game-area-placeholder" style="display:none;"></div>
        </header>

        <main id="game-area">
            <div class="progress-container">
                <div class="progress-bar" id="progress">Q1 / 10</div>
                <span id="question-id-display" class="question-id-badge">ID: ---</span>
            </div>
            <div class="question-container">
                <div class="instruction" id="instruction-text">誤っている箇所を訂正しなさい</div>
                <div id="sentence-area" class="sentence-display">
                    <!-- Dynamic Sentence with Interactive Spans -->
                </div>
            </div>

            <!-- Positioned dynamically -->
            <div id="selection-modal" class="selection-modal hidden">
                <!-- Options injected here -->
            </div>

            <div id="feedback" class="feedback-box">
                <div class="feedback-layout">
                    <div class="char-avatar-container">
                        <!-- Simple Character Avatar (CSS or SVG) -->
                        <div
                            style="width:100%; height:100%; background:#dbeafe; display:flex; align-items:center; justify-content:center; font-size:2rem;">
                            👩‍💼</div>
                    </div>
                    <div class="feedback-content">
                        <div id="char-msg" class="char-bubble"></div>
                        <h3 id="feedback-title" class="feedback-title">判定結果</h3>
                        <p id="feedback-desc" class="feedback-text">解説...</p>
                    </div>
                </div>
            </div>

            <div class="controls-area">
                <button id="check-btn" class="btn btn-primary">決定</button>
                <div style="display:flex; gap:10px;">
                    <button id="next-btn" class="btn btn-next hidden">次へ進む</button>
                    <button id="game-edit-btn" class="btn btn-secondary hidden" title="この問題を編集">📝</button>
                </div>
            </div>
        </main>

        <!-- Editor Screen -->
        <div id="editor-screen" class="screen hidden">
            <header class="app-header">
                <h2>問題編集</h2>
                <button id="editor-close-btn" class="icon-btn">✖</button>
            </header>
            <div class="editor-content">
                <div class="editor-controls">
                    <button id="add-question-btn" class="secondary-btn">+ 新規作成</button>
                    <button id="save-drive-btn" class="primary-btn">Driveに保存</button>
                </div>
                <div id="question-list" class="question-list">
                    <!-- List of questions -->
                </div>
                <div id="editor-form" class="editor-form hidden">
                    <h3>編集</h3>
                    <div class="form-group">
                        <label>ID</label>
                        <input type="text" id="edit-id">
                    </div>
                    <div class="form-group">
                        <label>ジャンル</label>
                        <input type="text" id="edit-genre" list="genre-list">
                        <datalist id="genre-list">
                            <option value="測量法">
                            <option value="多角測量">
                            <option value="基準点測量">
                            <option value="水準測量">
                            <option value="地形測量">
                            <option value="写真測量">
                            <option value="地図編集">
                            <option value="応用測量">
                        </datalist>
                    </div>
                    <div class="form-group">
                        <label>問題文のみため (セグメント編集)</label>
                        <div id="segment-editor-container">
                            <!-- Helper for Visual Editing -->
                            <div id="segment-list" class="segment-list"></div>
                            <button id="add-segment-btn" class="secondary-btn" style="width:100%; margin-top:5px;">+
                                文節を追加</button>
                        </div>
                        <input type="hidden" id="edit-segments"> <!-- Hidden input to store JSON for compatibility -->
                    </div>
                    <div class="form-group">
                        <label>解説</label>
                        <textarea id="edit-explanation" rows="3"></textarea>
                    </div>
                    <div class="form-actions">
                        <button id="edit-save-btn" class="primary-btn">決定</button>
                        <button id="edit-cancel-btn" class="secondary-btn">キャンセル</button>
                        <button id="edit-delete-btn" class="danger-btn">削除</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Screen -->
        <div id="stats-screen" class="screen hidden">
            <header class="app-header">
                <h2>学習記録</h2>
                <button id="stats-close-btn" class="icon-btn">✖</button>
            </header>
            <div class="stats-content">
                <div class="stats-summary">
                    <div class="stat-card">
                        <h3>総回答数</h3>
                        <p id="total-answers">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>正答率</h3>
                        <p id="total-rate">0%</p>
                    </div>
                    <div class="stat-card">
                        <h3>最終学習日</h3>
                        <p id="last-played">-</p>
                    </div>
                </div>
                <h3>ジャンル別正答率</h3>
                <div id="stats-chart" class="chart-container">
                    <!-- Chart bars -->
                </div>
                <button id="reset-stats-btn" class="danger-btn" style="margin-top:20px;">記録をリセット</button>
            </div>
        </div>

        <section id="result-area" class="hidden" style="text-align: center;">
            <h2 style="font-size: 2rem; color: var(--primary-color); margin-bottom: 0.5rem;" id="final-verdict">試験終了
            </h2>
            <div id="result-msg" style="margin-bottom: 2rem; font-weight: bold; color: #64748b;">お疲れ様でした！</div>

            <div class="score-value" id="final-score">0 / 0</div>

            <div class="chart-container" id="analytics-chart">
                <!-- Charts injected here -->
            </div>

            <div class="result-actions">
                <button id="retry-mistakes-btn" class="btn btn-warning hidden">間違えた問題を復習</button>
                <button onclick="location.reload()" class="btn btn-primary">設定を変えてやり直す</button>
            </div>
        </section>
    </div>

    <script src="questions.js"></script>
    <script src="app.js"></script>
</body>

</html>